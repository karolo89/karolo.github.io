---
title: "Reported Bias Crimes in Portland"
author: "Karol Orozco"
date: 03/02/2023
image: "stophate.png"
format:
  html:
    toc: true
    toc-location: right
    html-math-method: katex
output: html_document
execute:
  message: false
  warning: false
  echo: false
code-fold: true
categories:
  - Crime
  - Community
  - analysis
  - Quarto
  - Rstudio
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)

library(tidyverse)
library(showtext)
library(ggtext)
library(lubridate)
library(viridis)


crime<- read.csv("https://raw.githubusercontent.com/karolo89/Raw_Data/main/BiasCrime-All.csv")

crime$Report.Month.Year<- my(crime$Report.Month.Year)

crime <- crime%>%mutate(year= year(Report.Month.Year))

crime_type <- crime%>%
  group_by(Case.Type, year)%>%
  summarize(prov_freq = n())

```

```{r, fig.width=9}

library(directlabels)
library(gganimate)

plot <- ggplot(crime_type) +
 aes(x = year, y = prov_freq, colour = Case.Type) +
 geom_line() +
  
    geom_point(aes(x = year, y = prov_freq, shape=Case.Type, color=Case.Type))+
  
 scale_color_viridis(discrete = TRUE, option = "D")+
  scale_fill_viridis(discrete = TRUE) +
  
 labs(y = "Number of Cases", 
      x= "Year",
 title = "Report of Bias by Year", 
 subtitle = "Data current through September 2022", 
 
 caption = "Police Bureau: The graph visualizes the current case status for all reported bias/hate incidents that have been reviewed by the assigned detective.\nBias Incidents (instances in which bias occurred, but no crime occurred) began to be recorded in March 2020") +
    geom_dl(aes(label = Case.Type), method = list(dl.trans(x = x + 0.2), "last.points", cex = 0.8)) +
  
 theme_minimal() +
 theme(
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none",
        plot.title.position = "plot", 
        plot.subtitle = element_text(hjust = 0.5, lineheight = 0.4, size = 10),
        plot.title = element_text(lineheight = 0.5, face = "bold", size = 12, hjust = 0.5),
        axis.text = element_text(size = 7),
        axis.title = element_text(size= 8),
        plot.background = element_rect(fill = "#fafafa", colour = "#fafafa"),
        panel.background = element_rect(fill = "#fafafa", colour = "#fafafa"))

plot +transition_reveal(year)

```

```{r}
## Bias Category per year

## Bias Category & Type
bc_type <- crime%>%
  group_by(Bias.Type, Bias.Category, year)%>%
  summarise(frequency = n())%>%
filter(!(Bias.Category == "" | Bias.Category =="None"))

bc_type %>%
ggplot(aes(x = reorder(Bias.Category, -frequency, sum), y = frequency, fill = Bias.Category, colour = Bias.Category)) +
 geom_col() +
  scale_color_viridis(discrete = TRUE, option = "D")+
  scale_fill_viridis(discrete = TRUE) +
 theme_minimal() +
    scale_y_continuous(limits = c(0, 70)) +


  labs(x=" ", y=" ")+
  coord_flip()+
  theme(legend.position = "none", 
        panel.spacing = unit(1, "lines"),
        plot.title.position = "plot", 
        plot.caption.position = "plot", 
        plot.caption = element_text(hjust = 0, lineheight = 0.4, size = 10),
        plot.title = element_text(lineheight = 0.4, face = "bold", size = 12),
        strip.text = element_text(size = 10),
        axis.text = element_text(size = 10),
        plot.background = element_rect(fill = "#fafafa", colour = "#fafafa"),
        panel.background = element_rect(fill = "#fafafa", colour = "#fafafa"))
  
 facet_grid(vars(year), scale= "free_y")



```
```{r}


bias_t <- bc_type %>%
filter(year>= 2020)


p <- ggplot(bias_t) +
  aes(x = reorder(Bias.Type,-frequency,sum), y = frequency, colour= factor(Bias.Type), fill= Bias.Type) +
  geom_col() +
   scale_color_viridis(discrete = TRUE, option = "D")+
  scale_fill_viridis(discrete = TRUE) +
  labs(x = "", y= "") +
  coord_flip() +
  theme_minimal() +
theme(legend.position = "none", 
        panel.background = element_rect(fill = "#FAFAFA", colour = "#FAFAFA"), 
        plot.background = element_rect(fill = "#FAFAFA", colour = "#FAFAFA"), 
        legend.background = element_rect(fill = "transparent", colour = "transparent"), 
        legend.key = element_rect(fill = "transparent", colour = "transparent"),
        axis.text = element_text(family = "dosis", size= 5),
        panel.grid.major = element_line(colour = "#DEDEDE"), 
        panel.grid.minor = element_blank())

p
```


```{r, message=FALSE, warning=FALSE}
## Top Five Bias Incidents and Crimes Locations

p_loc <- crime %>%
  filter(year >= 2020)%>%
  filter(Case.Type== c("BIAS CRIME", "BIAS INCIDENT"))%>%
  group_by(Location.Type)%>%
  summarise(frequency = n())%>%
filter(frequency >= 7)


## Graph

loc <- ggplot(p_loc) +
 aes(x = reorder(Location.Type, -frequency, sum), y = frequency, fill= factor(Location.Type)) +
 geom_col(width = 0.5) +
  
 scale_color_viridis(discrete = TRUE, option = "D")+
  scale_fill_viridis(discrete = TRUE) +
  
 labs(y = "Number of Cases", x= "",
 title = "Top Five Bias Incidents and Crimes Locations", 
 subtitle = "Year 2020-22")+
  
 theme_minimal() +
  
 theme(
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        legend.position = "none",
        plot.title.position = "plot", 
        plot.subtitle = element_text(hjust = 0.5, lineheight = 0.4, size = 10),
        plot.title = element_text(lineheight = 0.5, face = "bold", size = 12, hjust = 0.5),
        axis.text = element_text(size = 7),
        axis.title = element_text(size= 8),
        plot.background = element_rect(fill = "#fafafa", colour = "#fafafa"),
        panel.background = element_rect(fill = "#fafafa", colour = "#fafafa"))



  loc+transition_states(Location.Type, wrap = FALSE) + shadow_mark() + enter_grow() +  enter_fade() 
  
```




